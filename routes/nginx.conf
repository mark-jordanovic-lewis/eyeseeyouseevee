# user  www www;
worker_processes  2;
pid /home/morb/Code/eyeseeyouseevee/routes/log/nginx.pid;

# [ debug | info | notice | warn | error | crit ]
error_log  /home/morb/Code/eyeseeyouseevee/routes/log/nginx.error_log debug;

events { }


http {
  # =========== #
  # Base Config #
  # =========== #
  include       mime.types;
  default_type  application/octet-stream;
  autoindex     on;
  disable_symlinks off;
  types_hash_max_size 10000;

  # ======= #
  # Logging #
  # ======= #
  log_format main      '$remote_addr - $remote_user [$time_local]  '
    '"$request" $status $bytes_sent '
    '"$http_referer" "$http_user_agent" '
    '"$gzip_ratio"';

  log_format download  '$remote_addr - $remote_user [$time_local]  '
    '"$request" $status $bytes_sent '
    '"$http_referer" "$http_user_agent" '
    '"$http_range" "$sent_http_content_range"';

  # ======== #
  # Timeouts #
  # ======== #
  client_header_timeout  3m;
  client_body_timeout    3m;
  send_timeout           3m;
  keepalive_timeout  75 20;
  # lingering_time     30;
  # lingering_timeout  10;
  # reset_timedout_connection  on;

  # ============== #
  # Buffer Control #
  # ============== #
  client_header_buffer_size    1k;
  large_client_header_buffers  4 4k;
  output_buffers   1 32k;
  postpone_output  1460;
  sendfile         on;
  tcp_nopush       on;
  tcp_nodelay      on;


  # ============= #
  # Proxy Caching #
  # ============= #
  # kill proxy cache, even if cached, don't try to use it
  proxy_no_cache 1;
  proxy_cache_bypass 1;
  proxy_buffering off;
  chunked_transfer_encoding off;

  # ================ #
  # DMZ Ingress Port # to angular (later only to authBox)
  # ================ #
  server {
    listen 7943;
    server_name correctedGareth.com;
    root /home/morb/Code/eyeseeyouseevee/routes/;

    access_log /home/morb/Code/eyeseeyouseevee/routes/log/gareth-ingress.log;
    access_log on;

    location / {
      index site/index.html index.html /404.html;
    }

    location /404.html {
      try_files $uri /$uri 404.html;
    }
  }

  # ==================== #
  # Other Helpful Config #
  # ==================== #

  # proxy headers
  # proxy_set_header Upgrade $http_upgrade;
  # proxy_set_header Connection 'upgrade';
  # proxy_set_header X-Real-IP $remote_addr;
  # proxy_set_header X-Forwarded-Host $host;
  # proxy_set_header X-Forwarded-Server $host;
  # proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
  # proxy_set_header X-Forwarded-Proto  $scheme;
  # proxy_cache_bypass $http_upgrade;
  # proxy_bind $server_addr;
  # proxy_redirect off;

  # caching headers
  # add_header Last-Modified $date_gmt;
  # add_header Cache-Control 'private no-store, no-cache, must-revalidate, proxy-revalidate, max-age=0';
  # if_modified_since off;
  # expires off;
  # etag off;

  # gzip
  # gzip on;
  # gzip_min_length  1100;
  # gzip_buffers     4 8k;
  # gzip_types       text/plain;
}




















# server {
#   listen        one.example.com;
#   server_name   one.example.com  www.one.example.com;
#
#   access_log   /var/log/nginx.access_log  main;
#
#   location / {
#     proxy_pass         http://127.0.0.1/;
#     proxy_redirect     off;
#
#     proxy_set_header   Host             $host;
#     proxy_set_header   X-Real-IP        $remote_addr;
#     # proxy_set_header  X-Forwarded-For  $proxy_add_x_forwarded_for;
#
#     client_max_body_size       10m;
#     client_body_buffer_size    128k;
#
#     client_body_temp_path      /var/nginx/client_body_temp;
#
#     proxy_connect_timeout      90;
#     proxy_send_timeout         90;
#     proxy_read_timeout         90;
#     proxy_send_lowat           12000;
#
#     proxy_buffer_size          4k;
#     proxy_buffers              4 32k;
#     proxy_busy_buffers_size    64k;
#     proxy_temp_file_write_size 64k;
#
#     proxy_temp_path            /var/nginx/proxy_temp;
#
#     charset  koi8-r;
#   }
#
#   error_page  404  /404.html;
#
#   location /404.html {
#     root  /spool/www;
#
#     charset         on;
#     source_charset  koi8-r;
#   }
#
#   location /old_stuff/ {
#     rewrite   ^/old_stuff/(.*)$  /new_stuff/$1  permanent;
#   }
#
#   location /download/ {
#     valid_referers  none  blocked  server_names  *.example.com;
#
#     if ($invalid_referer) {
#       #rewrite   ^/   http://www.example.com/;
#       return   403;
#     }
#
#     # rewrite_log  on;
#     # rewrite /download/*/mp3/*.any_ext to /download/*/mp3/*.mp3
#     rewrite ^/(download/.*)/mp3/(.*)\..*$ /$1/mp3/$2.mp3 break;
#
#     root         /spool/www;
#     # autoindex    on;
#     access_log   /var/log/nginx-download.access_log  download;
#   }
#
#   location ~* ^.+\.(jpg|jpeg|gif)$ {
#     root         /spool/www;
#     access_log   off;
#     expires      30d;
#   }
# }
